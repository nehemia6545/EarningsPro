<!DOCTYPE html>
<html lang="he" dir="rtl" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Earnings Pro - Financials</title>
    <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #0f1115; --card-bg: #1e222d; --panel-bg: #131722;
            --text-main: #e0e0e0; --text-muted: #8b949e;
            --accent-blue: #2962ff; --accent-green: #00c853; --accent-red: #d50000;
            --border-color: #2a2e39; --shadow: 0 4px 12px rgba(0,0,0,0.3);
            --modal-bg: rgba(0, 0, 0, 0.9);
        }
        /* (×©××¨ ×”-CSS ×”×‘×¡×™×¡×™ × ×©××¨ ×–×”×” ×œ××” ×©×”×™×” ×œ×š, ×× ×™ ××ª××§×“ ×‘-CSS ×©×œ ×”××•×“×œ ×”×—×“×©) */
        body { background-color: var(--bg-color); color: var(--text-main); font-family: 'Rubik', sans-serif; margin: 0; padding: 0; }
        
        /* HEADER & GRID STYLES (××§×•×¦×¨ ×œ×¦×•×¨×š ×”×“×’××”, ×ª×©××™×¨ ××ª ×”×¢×™×¦×•×‘ ×”×§×™×™× ×©×œ×š ×›××Ÿ) */
        header { padding: 15px; background: var(--card-bg); border-bottom: 1px solid var(--border-color); }
        .cards-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 15px; padding: 15px; }
        .stock-card { background: var(--card-bg); padding: 15px; border-radius: 8px; border: 1px solid var(--border-color); cursor: pointer; text-align: center; }
        
        /* --- NEW FINANCIAL MODAL STYLES --- */
        .modal-overlay { 
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: var(--modal-bg); z-index: 2000; display: none; 
            justify-content: center; align-items: center; backdrop-filter: blur(5px);
        }
        .modal-overlay.open { display: flex; }
        
        .fin-modal { 
            background: var(--card-bg); width: 95%; max-width: 900px; height: 90vh; 
            border-radius: 16px; border: 1px solid var(--border-color); display: flex; flex-direction: column; overflow: hidden;
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
        }

        .fin-header { 
            padding: 20px; border-bottom: 1px solid var(--border-color); background: var(--panel-bg);
            display: flex; justify-content: space-between; align-items: center;
        }
        .fin-title h2 { margin: 0; font-size: 24px; display: flex; align-items: center; gap: 10px; }
        .fin-title span { font-size: 14px; color: var(--text-muted); font-weight: normal; background: var(--border-color); padding: 2px 8px; border-radius: 4px; }
        .close-btn { background: none; border: none; color: var(--text-muted); font-size: 28px; cursor: pointer; }

        .fin-body { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 25px; }

        /* KPI Cards (Top Row) */
        .kpi-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 10px; }
        .kpi-card { background: var(--panel-bg); padding: 15px; border-radius: 8px; border: 1px solid var(--border-color); text-align: center; }
        .kpi-label { font-size: 12px; color: var(--text-muted); margin-bottom: 5px; }
        .kpi-value { font-size: 18px; font-weight: bold; direction: ltr; }
        .val-green { color: var(--accent-green); }
        .val-red { color: var(--accent-red); }

        /* Data Tables / Sections */
        .section-title { font-size: 16px; color: var(--accent-blue); margin-bottom: 10px; border-bottom: 1px solid var(--border-color); padding-bottom: 5px; margin-top: 10px; }
        
        .data-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; }
        .data-box { background: rgba(255,255,255,0.02); padding: 15px; border-radius: 8px; border: 1px solid var(--border-color); }
        .data-row { display: flex; justify-content: space-between; margin-bottom: 8px; font-size: 13px; border-bottom: 1px dashed var(--border-color); padding-bottom: 4px; }
        .data-row:last-child { border: none; }
        .data-row span:last-child { font-weight: 500; direction: ltr; }

        /* Guidance & Analysis Box */
        .analysis-box { background: rgba(41, 98, 255, 0.05); border: 1px solid var(--accent-blue); padding: 15px; border-radius: 8px; font-size: 14px; line-height: 1.5; color: var(--text-main); }
        .badge { display: inline-block; padding: 3px 8px; border-radius: 4px; font-size: 11px; font-weight: bold; margin-left: 5px; }
        .bg-pass { background: rgba(0, 200, 83, 0.2); color: #00e676; }
        .bg-fail { background: rgba(213, 0, 0, 0.2); color: #ff5252; }
        .bg-warn { background: rgba(255, 171, 0, 0.2); color: #ffab00; }

    </style>
</head>
<body>

<header>
    <h1 style="margin:0;">Earnings Pro <span style="font-size:14px; color:#888;">(Demo Mode)</span></h1>
</header>

<div class="cards-grid" id="mainGrid"></div>

<div class="modal-overlay" id="stockModal" onclick="closeModal(event)">
    <div class="fin-modal" onclick="event.stopPropagation()">
        <div class="fin-header">
            <div class="fin-title">
                <h2 id="mSymbol">AAPL <span id="mSector">Technology</span></h2>
                <div style="font-size:13px; color:#888;" id="mName">Apple Inc.</div>
            </div>
            <button class="close-btn" onclick="closeModalForce()">âœ•</button>
        </div>
        
        <div class="fin-body">
            
            <div class="kpi-grid">
                <div class="kpi-card">
                    <div class="kpi-label">×©×•×•×™ ×©×•×§</div>
                    <div class="kpi-value" id="mCap">-</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-label">P/E (××›×¤×™×œ)</div>
                    <div class="kpi-value" id="mPE">-</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-label">×¨×•×•×— ×œ×× ×™×” (EPS)</div>
                    <div class="kpi-value" id="mEPS">-</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-label">×ª×©×•××” ×¢×œ ×”×”×•×Ÿ (ROE)</div>
                    <div class="kpi-value" id="mROE">-</div>
                </div>
            </div>

            <div class="data-grid">
                <div class="data-box">
                    <div class="section-title">ğŸ“Š ×¨×•×•×— ×•×”×¤×¡×“ (Income)</div>
                    <div class="data-row"><span>×”×›× ×¡×•×ª (Revenue)</span> <span id="mRev">-</span></div>
                    <div class="data-row"><span>×¦××™×—×” (Revenue YoY)</span> <span id="mRevGrowth">-</span></div>
                    <div class="data-row"><span>×¨×•×•×— × ×§×™ (Net Income)</span> <span id="mNetInc">-</span></div>
                    <div class="data-row"><span>×©×•×œ×™ ×¨×•×•×— ×’×•×œ××™</span> <span id="mGrossMarg">-</span></div>
                    <div class="data-row"><span>×©×•×œ×™ ×¨×•×•×— ×ª×¤×¢×•×œ×™</span> <span id="mOpMarg">-</span></div>
                </div>

                <div class="data-box">
                    <div class="section-title">âš–ï¸ ×××–×Ÿ (Balance Sheet)</div>
                    <div class="data-row"><span>××–×•×× ×™× (Cash)</span> <span id="mCash">-</span></div>
                    <div class="data-row"><span>×—×•×‘×•×ª (Debt)</span> <span id="mDebt">-</span></div>
                    <div class="data-row"><span>×™×—×¡ ×©×•×˜×£ (Current Ratio)</span> <span id="mCurrRatio">-</span></div>
                    <div class="data-row" style="margin-top:10px; color:#aaa; font-size:11px;">
                        *×™×—×¡ ×©×•×˜×£ > 1.5 ××¢×™×“ ×¢×œ ×™×¦×™×‘×•×ª
                    </div>
                </div>

                <div class="data-box">
                    <div class="section-title">ğŸ’° ×ª×–×¨×™× ××–×•×× ×™× (Cash Flow)</div>
                    <div class="data-row"><span>×ª×–×¨×™× ××¤×¢×™×œ×•×ª (OCF)</span> <span id="mOCF">-</span></div>
                    <div class="data-row"><span>×ª×–×¨×™× ×—×•×¤×©×™ (FCF)</span> <span id="mFCF">-</span></div>
                    <div class="data-row"><span>×ª×©×•××ª ×“×™×‘×™×“× ×“</span> <span id="mDiv">-</span></div>
                </div>
            </div>

            <div class="section-title">ğŸ”® ×ª×—×–×™×ª ×•××™×¨×•×¢×™× (Guidance & Insights)</div>
            <div class="analysis-box">
                <div id="mGuidanceText">
                    </div>
            </div>

        </div>
    </div>
</div>

<script>
    // --- Helpers ---
    function formatMoney(n) {
        if (!n) return "-";
        if (n >= 1e12) return "$" + (n / 1e12).toFixed(2) + "T";
        if (n >= 1e9) return "$" + (n / 1e9).toFixed(2) + "B";
        if (n >= 1e6) return "$" + (n / 1e6).toFixed(2) + "M";
        return n.toLocaleString();
    }
    function formatPct(n) {
        if (!n) return "-";
        return (n * 100).toFixed(2) + "%";
    }
    function getColorClass(n) { return n > 0 ? 'val-green' : (n < 0 ? 'val-red' : ''); }

    // --- Render Stock Card (Simplified) ---
    function createCard(stock) {
        const el = document.createElement('div');
        el.className = 'stock-card';
        el.innerHTML = `<h3>${stock.symbol}</h3><div>${formatMoney(stock.marketCap)}</div>`;
        el.onclick = () => openFinancialModal(stock);
        return el;
    }

    // --- MAIN MODAL FUNCTION ---
    function openFinancialModal(stock) {
        // Headers
        document.getElementById('mSymbol').innerText = stock.symbol;
        document.getElementById('mName').innerText = stock.name || "";
        document.getElementById('mSector').innerText = stock.sector;

        // KPIs
        document.getElementById('mCap').innerText = formatMoney(stock.marketCap);
        document.getElementById('mPE').innerText = stock.trailingPE ? stock.trailingPE.toFixed(2) : "-";
        document.getElementById('mEPS').innerText = stock.eps ? "$" + stock.eps.toFixed(2) : "-";
        
        const roe = stock.returnOnEquity;
        document.getElementById('mROE').innerText = formatPct(roe);
        document.getElementById('mROE').className = "kpi-value " + (roe > 0.15 ? 'val-green' : '');

        // Income
        document.getElementById('mRev').innerText = formatMoney(stock.revenue);
        document.getElementById('mRevGrowth').innerText = formatPct(stock.revenueGrowth);
        document.getElementById('mRevGrowth').className = getColorClass(stock.revenueGrowth);
        document.getElementById('mNetInc').innerText = formatMoney(stock.netIncome);
        document.getElementById('mGrossMarg').innerText = formatPct(stock.grossMargins);
        document.getElementById('mOpMarg').innerText = formatPct(stock.operatingMargins);

        // Balance
        document.getElementById('mCash').innerText = formatMoney(stock.totalCash);
        document.getElementById('mDebt').innerText = formatMoney(stock.totalDebt);
        const cr = stock.currentRatio;
        document.getElementById('mCurrRatio').innerText = cr ? cr.toFixed(2) : "-";
        document.getElementById('mCurrRatio').style.color = cr >= 1.5 ? '#00e676' : (cr < 1 ? '#ff5252' : '#fff');

        // Cash Flow
        document.getElementById('mOCF').innerText = formatMoney(stock.operatingCashflow);
        document.getElementById('mFCF').innerText = formatMoney(stock.freeCashflow);
        document.getElementById('mDiv').innerText = formatPct(stock.dividendYield);

        // Guidance Analysis Logic (Simple AI Simulation)
        let analysisHtml = "";
        
        // P/E Check
        if (stock.forwardPE && stock.trailingPE) {
            if (stock.forwardPE < stock.trailingPE) {
                analysisHtml += `<div><span class="badge bg-pass">×—×™×•×‘×™</span> ×”××›×¤×™×œ ×”×¢×ª×™×“×™ (Forward P/E: ${stock.forwardPE.toFixed(2)}) × ××•×š ××”× ×•×›×—×™, ××” ×©××¨××– ×¢×œ ×¦×¤×™ ×œ×¦××™×—×” ×‘×¨×•×•×—×™×.</div>`;
            } else {
                analysisHtml += `<div><span class="badge bg-warn">×–×”×™×¨×•×ª</span> ×”××›×¤×™×œ ×”×¢×ª×™×“×™ ×’×‘×•×” ××”× ×•×›×—×™, ×™×™×ª×›×Ÿ ×¦×¤×™ ×œ×”××˜×”.</div>`;
            }
        }

        // FCF Check
        if (stock.freeCashflow > 0 && stock.netIncome > 0) {
             analysisHtml += `<div style="margin-top:8px;"><span class="badge bg-pass">×—×–×§</span> ×œ×—×‘×¨×” ×ª×–×¨×™× ××–×•×× ×™× ×—×•×¤×©×™ ×—×™×•×‘×™, ×”×××¤×©×¨ ×“×™×‘×™×“× ×“×™× ×•×¨×›×™×©×” ×¢×¦××™×ª.</div>`;
        }

        // Guidance Placeholder
        analysisHtml += `<div style="margin-top:15px; font-size:12px; color:#888;">
            * ×”×¢×¨×”: × ×ª×•× ×™× ××œ×• ××‘×•×¡×¡×™× ×¢×œ ×”×“×•×— ×”××—×¨×•×Ÿ. ×‘×“×•×§ ××ª ××•×¢×“ ×”×“×•×— ×”×§×¨×•×‘ (${stock.earningsDate}) ×œ×¢×“×›×•× ×™×.
            <br>
            <a href="https://finance.yahoo.com/quote/${stock.symbol}/analysis" target="_blank" style="color:var(--accent-blue);">×œ×§×¨×™××ª ×ª×—×–×™×•×ª ×× ×œ×™×¡×˜×™× ××œ××•×ª ×‘×™××”×• >></a>
        </div>`;

        document.getElementById('mGuidanceText').innerHTML = analysisHtml;

        document.getElementById('stockModal').classList.add('open');
    }

    function closeModalForce() {
        document.getElementById('stockModal').classList.remove('open');
    }
    function closeModal(e) {
        if(e.target.id === 'stockModal') closeModalForce();
    }

    // Load Data
    fetch('data.json')
        .then(res => res.json())
        .then(data => {
            const grid = document.getElementById('mainGrid');
            data.forEach(stock => grid.appendChild(createCard(stock)));
        });

</script>

</body>
</html>
